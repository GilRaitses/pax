<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pax NYC - Traffic Camera Collection Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-subtext {
            font-size: 0.85em;
            color: #999;
            margin-top: 5px;
        }
        
        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .camera-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .camera-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .camera-name {
            font-weight: 600;
            font-size: 1.05em;
            color: #333;
            flex: 1;
        }
        
        .camera-badge {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .camera-badge.high { background: #f56565; }
        .camera-badge.medium { background: #ed8936; }
        .camera-badge.low { background: #48bb78; }
        
        .camera-meta {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .camera-count {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }
        
        .camera-last-capture {
            font-size: 0.8em;
            color: #999;
        }
        
        .refresh-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .section-title {
            color: white;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            margin-top: 30px;
        }
        
        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .storage-info {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9em;
        }
        
        .proposal-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .proposal-section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .proposal-section h3 {
            color: #764ba2;
            font-size: 1.3em;
            margin-bottom: 12px;
            margin-top: 0;
        }
        
        .proposal-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .proposal-card p {
            margin: 0;
            line-height: 1.6;
        }
        
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 style="font-size: 2.8em; margin-bottom: 15px;">Energetic Pathfinding and Perceptual Heuristics</h1>
            <div class="subtitle" style="font-size: 1.3em; margin-bottom: 10px;">Manhattan Navigation via Learned A* Search</div>
            <div style="margin-top: 15px; font-size: 0.95em; opacity: 0.9;">
                <div>CIS 667: Introduction to Artificial Intelligence – Term Project</div>
                <div style="margin-top: 8px;">Gil Raitses | Syracuse University | Data Science / HCAI Program</div>
            </div>
        </header>

        <div class="proposal-section">
            <h2 style="color: #667eea; font-size: 2.2em; margin-bottom: 30px; text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 15px;">
                Multi-Scale Coverage Zone Analysis
            </h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px; margin: 40px 0;">
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-left: 5px solid #667eea;">
                    <h3 style="color: #764ba2; margin-top: 0; margin-bottom: 15px;">Problem Space</h3>
                    <img src="logs/2025-11-09/outputs/problem_space.png" 
                         alt="Problem Space: Multi-Scale Coverage Zones" 
                         style="width: 100%; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 15px;">
                    <p style="font-size: 0.95em; line-height: 1.6; color: #555; font-style: italic; margin: 0;">
                        <strong>Problem Space for Undirected Graph Search with Multi-Scale Coverage Zones.</strong> 
                        Spatial coverage zones (defined by traffic camera locations) partition the search space to enable 
                        multi-scale resolution analysis. The coverage zones represent different levels of granularity needed 
                        to determine Pareto-optimal solutions, allowing the search algorithm to efficiently explore the solution 
                        frontier by considering both local neighborhood characteristics and global path structure.
                    </p>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-left: 5px solid #764ba2;">
                    <h3 style="color: #764ba2; margin-top: 0; margin-bottom: 15px;">Camera Corridor</h3>
                    <img src="logs/2025-11-09/outputs/camera_corridor_partition.png" 
                         alt="Camera Corridor with Extended Coverage Zones" 
                         style="width: 100%; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 15px;">
                    <p style="font-size: 0.95em; line-height: 1.6; color: #555; font-style: italic; margin: 0;">
                        <strong>Camera Corridor with Extended Coverage Zones.</strong> 
                        Extended camera corridor (purple boundary: 34th-66th St, 3rd-9th/Amsterdam) containing 82 traffic cameras 
                        used for multi-scale resolution analysis. The problem space (red boundary) is nested within this wider corridor, 
                        demonstrating the relationship between the constrained search space and the extended coverage area needed for 
                        Pareto front determination.
                    </p>
                </div>
            </div>
            
            <h2 style="color: #667eea; font-size: 1.8em; margin-top: 40px; margin-bottom: 20px; border-top: 2px solid #667eea; padding-top: 20px;">Research Question</h2>
            <p style="font-size: 1.1em; line-height: 1.7; color: #333;">
                Can learned heuristics from vision-based environmental features outperform standard 
                Manhattan-distance baselines in predicting route stress and improving path interpretability?
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0;">
                <div class="proposal-card">
                    <h3>Problem</h3>
                                    <p>Traditional pathfinding algorithms optimize for geometric distance but fail to capture the 
                                    <strong>energetic and perceptual dynamics</strong> of movement in dense urban environments. 
                                    Routes involve sensory complexity: crowding, visual noise, infrastructure gaps, and unpredictability.</p>
                </div>
                <div class="proposal-card">
                    <h3>Approach</h3>
                    <p>Develop a <strong>perceptually informed heuristic</strong> for A* search using NYC traffic camera data. 
                    The heuristic models environmental resistance by extracting features from visual data—encoding 
                    how pedestrians naturally avoid stressful routes.</p>
                </div>
                <div class="proposal-card">
                    <h3>Study Area</h3>
                    <p><strong>Grand Central → Carnegie Hall corridor</strong><br>
                    Manhattan: 40th-59th Streets, Lexington Ave to 8th Ave<br>
                    161 intersection nodes • 40 camera zones<br>
                    Start: Grand Central (42nd & Park)<br>
                    Goal: Carnegie Hall (57th & 7th Ave)</p>
                </div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 12px; margin: 30px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="color: #667eea; margin-top: 0;">Methodology</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div>
                        <strong>State Space:</strong> 161 intersections from NYC DCM street centerlines
                    </div>
                    <div>
                        <strong>Sensors:</strong> 40 cameras providing multi-dimensional feature vectors
                    </div>
                    <div>
                        <strong>Heuristic:</strong> Learned via Ridge regression: <code>h(n) = w^T f(zone(n))</code>
                    </div>
                    <div>
                        <strong>Search:</strong> A* with Manhattan baseline vs. learned perceptual heuristic
                    </div>
                </div>
            </div>
        </div>
        
        <div class="error-message" id="errorMessage"></div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Images Collected</div>
                <div class="stat-value" id="totalImages">0</div>
                <div class="stat-subtext" id="totalImagesSubtext">From GCS bucket</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Purple Zone Cameras</div>
                <div class="stat-value" id="activeCameras">82</div>
                <div class="stat-subtext">34th-66th St, 3rd-9th/Amsterdam</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Today's Images</div>
                <div class="stat-value" id="todayImages">0</div>
                <div class="stat-subtext" id="todayImagesSubtext">Last 24 hours</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Latest Capture</div>
                <div class="stat-value" id="latestCapture" style="font-size: 1.2em;">--</div>
                <div class="stat-subtext" id="latestCaptureSubtext">UTC time</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Collection Period</div>
                <div class="stat-value" id="collectionDays" style="font-size: 1.5em;">0</div>
                <div class="stat-subtext" id="collectionPeriod">Days active</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Collection Rate</div>
                <div class="stat-value" id="collectionRate" style="font-size: 1.5em;">48</div>
                <div class="stat-subtext">Images/camera/day (30 min intervals)</div>
            </div>
        </div>
        
        <div class="storage-info">
            <strong>GCS Bucket:</strong> <span id="bucketInfo">gs://pax-nyc-images/images/</span><br>
            <strong>Status:</strong> <span id="storageInfo">Loading collection stats...</span><br>
            <strong>Collection Schedule:</strong> Every 30 minutes (48 images/day per camera)
        </div>
        
        <h2 class="section-title">Collection Status</h2>
        
        <div style="background: white; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3 style="color: #667eea; margin-top: 0; margin-bottom: 15px;">Current Collection</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <strong>Cameras:</strong> 82 (numbered 1-82)<br>
                    <strong>Zone:</strong> Purple corridor (34th-66th St)
                </div>
                <div>
                    <strong>Expected:</strong> 3,936 images/day<br>
                    <strong>Target:</strong> 672 images/camera over 14 days
                </div>
                <div>
                    <strong>Job:</strong> pax-collector-v2<br>
                    <strong>Scheduler:</strong> Every 30 minutes
                </div>
            </div>
        </div>
        
        <div class="camera-grid" id="cameraGrid">
            <!-- Camera cards will be inserted here -->
        </div>
        
        <div class="refresh-indicator">
            <div class="spinner"></div>
            <span>Auto-refresh every 30s</span>
        </div>
    </div>
    
    <script>
        // Try multiple paths for stats.json (GitHub Pages compatibility)
        const STATS_PATHS = [
            './stats.json',
            './docs/stats.json',
            'stats.json',
            'docs/stats.json'
        ];
        
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:8000' 
            : '';
        
        let cameraManifest = [];
        let statsData = null;
        
        async function loadManifest() {
            try {
                // Try numbered manifest first
                let manifestPath = './data/corridor_cameras_numbered.json';
                let response = await fetch(manifestPath);
                
                if (!response.ok) {
                    // Fallback to API or cameras.yaml
                    if (API_BASE) {
                        response = await fetch(`${API_BASE}/api/manifest`);
                    } else {
                        manifestPath = './cameras.yaml';
                        response = await fetch(manifestPath);
                    }
                }
                
                if (response.ok) {
                    const manifest = await response.json();
                    cameraManifest = manifest.cameras || [];
                    console.log(`Loaded ${cameraManifest.length} cameras from manifest`);
                }
            } catch (error) {
                console.warn('Failed to load manifest:', error);
                // Continue without manifest
            }
        }
        
        async function fetchStats() {
            // Try API first (local dev)
            if (API_BASE) {
                try {
                    const response = await fetch(`${API_BASE}/api/stats`);
                    if (response.ok) {
                        const stats = await response.json();
                        updateDashboard(stats);
                        return;
                    }
                } catch (error) {
                    console.log('API not available, trying static stats');
                }
            }
            
            // Try static stats.json files
            for (const path of STATS_PATHS) {
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        const stats = await response.json();
                        statsData = stats;
                        updateDashboard(stats);
                        return;
                    }
                } catch (error) {
                    continue;
                }
            }
            
            // Fallback: show error
            console.error('Failed to fetch stats from all sources');
            showError('Unable to load collection statistics. Stats may be updating...');
            updateDashboard({
                totalImages: 0,
                activeCameras: 82,
                todayImages: 0,
                latestCapture: null,
                cameraCounts: {},
                storageInfo: 'Stats unavailable',
                collectionPeriod: { days: 0, start: null, end: null },
            });
        }
        
        function updateDashboard(stats) {
            document.getElementById('totalImages').textContent = (stats.totalImages || 0).toLocaleString();
            document.getElementById('activeCameras').textContent = stats.activeCameras || 82;
            document.getElementById('todayImages').textContent = (stats.todayImages || 0).toLocaleString();
            
            if (stats.latestCapture) {
                const captureDate = new Date(stats.latestCapture);
                document.getElementById('latestCapture').textContent = captureDate.toLocaleString();
                document.getElementById('latestCaptureSubtext').textContent = 
                    stats.latestCameraName || 'Latest collection';
            } else {
                document.getElementById('latestCapture').textContent = '--';
            }
            
            if (stats.collectionPeriod) {
                document.getElementById('collectionDays').textContent = stats.collectionPeriod.days || 0;
                if (stats.collectionPeriod.start && stats.collectionPeriod.end) {
                    document.getElementById('collectionPeriod').textContent = 
                        `${stats.collectionPeriod.start} to ${stats.collectionPeriod.end}`;
                }
            }
            
            document.getElementById('storageInfo').textContent = stats.storageInfo || 'Loading...';
            
            if (stats.bucket) {
                document.getElementById('bucketInfo').textContent = `gs://${stats.bucket}/images/`;
            }
            
            // Update camera grid with numbered cameras
            const cameraGrid = document.getElementById('cameraGrid');
            cameraGrid.innerHTML = '';
            
            if (cameraManifest.length > 0) {
                // Sort by number
                const sortedCameras = [...cameraManifest].sort((a, b) => 
                    (a.number || 999) - (b.number || 999)
                );
                
                sortedCameras.forEach(camera => {
                    const cameraData = stats.cameraCounts?.[camera.id] || { count: 0, lastCapture: null };
                    const card = createCameraCard(camera, cameraData);
                    cameraGrid.appendChild(card);
                });
            } else if (stats.cameraCounts) {
                // Fallback: show cameras from stats
                Object.entries(stats.cameraCounts).forEach(([cameraId, data]) => {
                    const camera = { id: cameraId, name: cameraId, number: null };
                    const card = createCameraCard(camera, data);
                    cameraGrid.appendChild(card);
                });
            }
        }
        
        function createCameraCard(camera, data) {
            const card = document.createElement('div');
            card.className = 'camera-card';
            
            const lastCapture = data.lastCapture 
                ? new Date(data.lastCapture).toLocaleString()
                : 'No captures yet';
            
            const cameraNumber = camera.number ? `#${camera.number}` : '';
            const cameraName = camera.name || camera.id;
            
            card.innerHTML = `
                <div class="camera-header">
                    <div class="camera-name">${cameraNumber ? cameraNumber + ': ' : ''}${cameraName}</div>
                    ${camera.number ? `<div class="camera-badge" style="background: #2ecc71;">#${camera.number}</div>` : ''}
                </div>
                ${camera.latitude ? `<div class="camera-meta">${camera.latitude.toFixed(4)}, ${camera.longitude.toFixed(4)}</div>` : ''}
                <div class="camera-count">${(data.count || 0).toLocaleString()}</div>
                <div class="camera-last-capture">Last: ${lastCapture}</div>
            `;
            
            return card;
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        // Initial load
        async function initialize() {
            await loadManifest();
            await fetchStats();
        }
        
        initialize();
        
        // Auto-refresh every 30 seconds
        setInterval(fetchStats, 30000);
    </script>
</body>
</html>

